# Build-datawarehouse-datamarts
Using SQL/Python - oracle developer


![image](https://user-images.githubusercontent.com/84145744/169695982-0a48dac6-0be4-4590-af44-24ea63b4ca4b.png)



















select * from WATER_QUALITY;

select count(*) from WATER_QUALITY;

Select count (distinct ("determinandnotation")) from "WATER_QUALITY";


----------create dimension table for sample

CREATE TABLE dim_sample
(
	sample_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 ,
	samplevalid VARCHAR2(200),
	samplesamplingpoint VARCHAR2(200),
	samplesamplingpointnotation VARCHAR2(200),
	samplesamplingpointlabel VARCHAR2(50),
	sampleiscompliancesample VARCHAR2(6),
	samplepurposelabel VARCHAR2(60),
	samplesamplingpointeasting NUMBER(10),
	samplesamplingpointnorthing NUMBER(10),
	PRIMARY KEY (sample_id)
);

----------create dimension table for determinand

CREATE TABLE dim_determinand
(
	determinandnotation NUMBER(20),
	determinandlabel VARCHAR2(40),
	determinanddefinition VARCHAR2(80),
	determinandunitlabel VARCHAR2(10),
	PRIMARY KEY (determinandnotation)
);

----------create dimension table for time

CREATE TABLE dim_time
(
	time_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 ,
	sample_date DATE NOT NULL,
	time VARCHAR2(10) NOT NULL,
	week NUMBER(5) NOT NULL,
	month VARCHAR2(10) NOT NULL,
	year VARCHAR(5) NOT NULL,
	PRIMARY KEY (time_id)
);

----------create fact table 

CREATE TABLE fact_watersensor
(
	id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 
	INCREMENT BY 1 START WITH 1 ,
	sample_id NUMBER,
	time_id NUMBER,
	determinandnotation NUMBER(20),
	samplesampledmaterialtypelabel VARCHAR2(60),
	result Number,
	PRIMARY KEY (id),
	FOREIGN KEY (sample_id) references dim_sample(sample_id) on delete CASCADE,
	FOREIGN KEY (time_id) references dim_time(time_id) on delete CASCADE,
	FOREIGN KEY (determinandnotation) references dim_determinand(determinandnotation) on delete CASCADE
);

----------Alter surrogate keys (auto generated number column)

ALTER TABLE FACT_WATERSENSOR MODIFY ID NUMBER GENERATED ALWAYS as IDENTITY(START with 1 INCREMENT by 1);

ALTER TABLE DIM_TIME MODIFY TIME_ID NUMBER GENERATED ALWAYS as IDENTITY(START with 1 INCREMENT by 1);

ALTER TABLE DIM_SAMPLE MODIFY SAMPLE_ID NUMBER GENERATED ALWAYS as IDENTITY(START with 1 INCREMENT by 1);


----------populate data into DIM_SAMPLE

declare
Cursor CUR is
Select "@id","samplesamplingPoint","samplesamplingPointnotation","samplesamplingPointlabel",
"sampleisComplianceSample","samplepurposelabel","samplesamplingPointeasting",
"samplesamplingPointnorthing" from "WATER_QUALITY";

begin
for ct in CUR loop

insert into DIM_SAMPLE(SAMPLEVALID,SAMPLESAMPLINGPOINT,SAMPLESAMPLINGPOINTNOTATION,SAMPLESAMPLINGPOINTLABEL,
SAMPLEISCOMPLIANCESAMPLE,SAMPLEPURPOSELABEL,SAMPLESAMPLINGPOINTEASTING,SAMPLESAMPLINGPOINTNORTHING)
values (ct."@id",ct."samplesamplingPoint",ct."samplesamplingPointnotation",ct."samplesamplingPointlabel",DECODE(ct."sampleisComplianceSample",'0', 'FALSE', '1', 'TRUE'),
ct."samplepurposelabel",ct."samplesamplingPointeasting",ct."samplesamplingPointnorthing");

end loop;
end;

----------populate data into DIM_DETERMINAND

declare
Cursor CUR is
Select distinct "determinandnotation","determinandlabel","determinanddefinition","determinandunitlabel" from "WATER_QUALITY";
begin
for ct in CUR loop
insert into DIM_DETERMINAND(DETERMINANDNOTATION,DETERMINANDLABEL,DETERMINANDDEFINITION,DETERMINANDUNITLABEL)
values (ct."determinandnotation",ct."determinandlabel",ct."determinanddefinition",ct."determinandunitlabel");
end loop;
end;

----------populate data into DIM_TIME

declare
Cursor CUR is
select "samplesampleDateTime"
from "WATER_QUALITY";
Dates DATE;
begin
for ct in CUR loop
Dates:=TO_DATE(ct."samplesampleDateTime",'YYYY-MM-DD"T"HH24:MI:SS"Z"');
insert into DIM_TIME(SAMPLE_DATE, TIME, WEEK, MONTH, YEAR)
values(Dates,TO_CHAR(Dates,'HH24:MI:SS'),To_NUMBER(TO_CHAR(Dates, 'WW')),
TO_CHAR(Dates,'Month'),TO_CHAR(Dates,'YYYY'));
end loop;
end;

----------populate data into FACT_WATERSENSOR

declare
Cursor CUR is
select "ID",SAMPLE_ID,TIME_ID,DETERMINANDNOTATION,"samplesampledMaterialTypelabel","result" FROM "WATER_QUALITY" WQ,DIM_SAMPLE s,DIM_TIME t,DIM_DETERMINAND d
WHERE WQ."ID" = S.SAMPLE_ID AND WQ."ID" = T.TIME_ID AND WQ."determinandnotation" = D.DETERMINANDNOTATION;
begin
for ct in CUR loop
insert into FACT_WATERSENSOR1(SAMPLE_ID,TIME_ID,DETERMINANDNOTATION,SAMPLESAMPLEDMATERIALTYPELABEL,RESULT)
values(ct.SAMPLE_ID,ct.TIME_ID,ct.DETERMINANDNOTATION,ct."samplesampledMaterialTypelabel",ct."result");
end loop;
end;

select * from fact_watersensor;

Select count (*) from 

SQL QUERIES: 

---------- 1.The list of water sensors measured by type of it by month---------------

SELECT d.DETERMINANDLABEL as SENSOR_TYPE,f.RESULT as MEASUREMENT,t.MONTH 
FROM FACT_WATERSENSOR f,DIM_TIME t,DIM_DETERMINAND d  
where f.time_id = t.time_id and f.DETERMINANDNOTATION = d.DETERMINANDNOTATION order by d.DETERMINANDLABEL; 

---------- 2.The number of sensor measurements collected by type of sensor by week

SELECT d.DETERMINANDLABEL as sensor_type,t.WEEK,COUNT(f.RESULT) as No_of_sensor_measurements_by_week  
FROM FACT_WATERSENSOR f,DIM_TIME t,DIM_DETERMINAND d  
where f.time_id = t.time_id and f.DETERMINANDNOTATION = d.DETERMINANDNOTATION 
group by t.WEEK,d.DETERMINANDLABEL order by t.WEEK,d.DETERMINANDLABEL; 

---------- 3.The number of measurements made by location by month

SELECT COUNT(f.RESULT) as SENSOR_MEASUREMENT_COUNT ,s.SAMPLESAMPLINGPOINTLABEL as LOCATION,t.month 
FROM FACT_WATERSENSOR f,DIM_TIME t,DIM_SAMPLE s  
where f.time_id = t.time_id and f.sample_id = s.sample_id 
group by t.month,s.SAMPLESAMPLINGPOINTLABEL order by s.SAMPLESAMPLINGPOINTLABEL; 

---------- 4.The average number of measurements covered for PH by year

with ph_total as(
SELECT t.YEAR,COUNT(f.RESULT) as yearly_average   FROM FACT_WATERSENSOR f,DIM_TIME t,DIM_DETERMINAND d 
where f.time_id = t.time_id and f.DETERMINANDNOTATION = d.DETERMINANDNOTATION and d.DETERMINANDLABEL = 'pH'  
group by t.YEAR),
overall as(SELECT t.YEAR,COUNT(f.RESULT) as yearly_average   FROM FACT_WATERSENSOR f,DIM_TIME t,DIM_DETERMINAND d 
where f.time_id = t.time_id and f.DETERMINANDNOTATION = d.DETERMINANDNOTATION  
group by t.year)
select ph_total.year,ph_total.yearly_average as PH_COUNT,overall.yearly_average as REST_SENSOR_COUNT,
round(((ph_total.yearly_average/overall.yearly_average)*100),2) as ph_sensor_avg from ph_total
join overall on ph_total.year=overall.year order by year;

---------- 5.The average value of Nitrate measurements by locations by year

SELECT d.DETERMINANDLABEL as SENSOR_TYPE,s.SAMPLESAMPLINGPOINTLABEL as LOCATION,t.YEAR ,round(AVG(f.RESULT),2) as yearly_average  
FROM FACT_WATERSENSOR f,DIM_TIME t,DIM_SAMPLE s,DIM_DETERMINAND d 
where f.time_id = t.time_id and f.sample_id = s.sample_id  and f.DETERMINANDNOTATION = d.DETERMINANDNOTATION and d.DETERMINANDLABEL = 'Nitrite-N'  
group by s.SAMPLESAMPLINGPOINTLABEL,t.year,d.DETERMINANDLABEL order by t.year;

---------- Selecting Water sensor 'Ammonia(N)'

select f.samplesampledmaterialtypelabel as Sample_Material_Type, T.year, ROUND(AVG(F.result),2) as Average_Result_Per_Year from dim_determinand D, fact_watersensor F, dim_time T
where d.determinandlabel = 'Ammonia(N)' and f.determinandnotation = d.determinandnotation and T.time_id = f.time_id 
group by T.year, f.samplesampledmaterialtypelabel order by T.year

